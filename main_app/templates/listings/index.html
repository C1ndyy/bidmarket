{% extends 'base.html'%}
{% block content %}

{% block css %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/listings.css' %}">
{% endblock %}


<form method="get" action="">
  <div id="search-bar">
    <input name='q' value='{{ q }}' type="text" placeholder="What are you looking for?" autocomplete="off">
    <button type="submit">
      <span class="material-icons">
        search
      </span>
    </button>
  </div>
  <div id="sort-popup" class="popup">
    Sort Results By
    <div class="sort-options" id="id-{{ sortby }}">
      <label class="radio-container">price low to high
        <input type="radio" id="price-LH" name="sortby" value="price-LH">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">price high to low
        <input type="radio" id="price-HL" name="sortby" value="price-HL">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">ending soon
        <input type="radio" id="ending-soon" name="sortby" value="ending-soon">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">oldest first
        <input type="radio" id="oldest-first" name="sortby" value="oldest-first">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">newest-first
        <input type="radio" id="newest-first" name="sortby" value="newest-first">
        <div class="radio-button"></div>
      </label>
    </div>
    <button type='submit'>Save</button>
  </div>

  <div id="filter-popup" class="popup">
    Filter By Category
    <div class="category-options" id="id-{{ category }}">
      <label class="radio-container">Home
        <input type="radio" id="home" name="category" value="home">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">Tech
        <input type="radio" id="tech" name="category" value="tech">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">Fashion
        <input type="radio" id="fashion" name="category" value="fashion">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">Sporting
        <input type="radio" id="sporting" name="category" value="sporting">
        <div class="radio-button"></div>
      </label>
      <label class="radio-container">Books
        <input type="radio" id="books" name="category" value="books">
        <div class="radio-button"></div>
      </label>
    </div>
    <button type='submit'>Save</button>
  </div>
</form>

<div id="icons">
  <div id="clear-filters">
    <form method="get" action="">
      <input type="submit" value="clear filters">
    </form>
  </div>
  <div id="sort-icon">
    <img src="https://img.icons8.com/ios/50/000000/sort.png" />
    <p>sort</p>
  </div>

  <div id="filter-icon">
    <!-- <span> -->
    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30" height="30" viewBox="0 0 172 172"
      style=" fill:#000000;">
      <g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter"
        stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none"
        font-size="none" text-anchor="none" style="mix-blend-mode: normal">
        <path d="M0,172v-172h172v172z" fill="none"></path>
        <g id="original-icon" fill="#000000">
          <path
            d="M86,24.08c-6.36937,0 -11.7175,4.42094 -13.26281,10.32h-62.41719c-1.23625,-0.01344 -2.39187,0.63156 -3.02344,1.70656c-0.61813,1.075 -0.61813,2.39187 0,3.46687c0.63156,1.075 1.78719,1.72 3.02344,1.70656h62.41719c1.54531,5.89906 6.89344,10.32 13.26281,10.32c6.36938,0 11.7175,-4.42094 13.26281,-10.32h62.41719c1.23625,0.01344 2.39188,-0.63156 3.02344,-1.70656c0.61813,-1.075 0.61813,-2.39187 0,-3.46687c-0.63156,-1.075 -1.78719,-1.72 -3.02344,-1.70656h-62.41719c-1.54531,-5.89906 -6.89344,-10.32 -13.26281,-10.32zM86,30.96c3.73563,0 6.67844,2.87563 6.83969,6.57094c-0.01344,0.20156 -0.01344,0.41656 0,0.63156c-0.16125,3.68188 -3.10406,6.5575 -6.83969,6.5575c-3.73562,0 -6.67844,-2.87562 -6.83969,-6.57094c0.01344,-0.20156 0.01344,-0.41656 0,-0.63156c0.16125,-3.68187 3.10406,-6.5575 6.83969,-6.5575zM134.16,72.24c-6.36937,0 -11.7175,4.42094 -13.26281,10.32h-110.57719c-1.23625,-0.01344 -2.39187,0.63156 -3.02344,1.70656c-0.61813,1.075 -0.61813,2.39187 0,3.46687c0.63156,1.075 1.78719,1.72 3.02344,1.70656h110.57719c1.54531,5.89906 6.89344,10.32 13.26281,10.32c6.36938,0 11.7175,-4.42094 13.26281,-10.32h14.25719c1.23625,0.01344 2.39188,-0.63156 3.02344,-1.70656c0.61813,-1.075 0.61813,-2.39187 0,-3.46687c-0.63156,-1.075 -1.78719,-1.72 -3.02344,-1.70656h-14.25719c-1.54531,-5.89906 -6.89344,-10.32 -13.26281,-10.32zM134.16,79.12c3.73563,0 6.67844,2.87563 6.83969,6.57094c-0.01344,0.20156 -0.01344,0.41656 0,0.63156c-0.16125,3.68188 -3.10406,6.5575 -6.83969,6.5575c-3.73562,0 -6.67844,-2.87562 -6.83969,-6.57094c0.01344,-0.20156 0.01344,-0.41656 0,-0.63156c0.16125,-3.68187 3.10406,-6.5575 6.83969,-6.5575zM48.16,120.4c-6.36937,0 -11.7175,4.42094 -13.26281,10.32h-24.57719c-1.23625,-0.01344 -2.39187,0.63156 -3.02344,1.70656c-0.61813,1.075 -0.61813,2.39187 0,3.46687c0.63156,1.075 1.78719,1.72 3.02344,1.70656h24.57719c1.54531,5.89906 6.89344,10.32 13.26281,10.32c6.36938,0 11.7175,-4.42094 13.26281,-10.32h100.25719c1.23625,0.01344 2.39188,-0.63156 3.02344,-1.70656c0.61813,-1.075 0.61813,-2.39187 0,-3.46687c-0.63156,-1.075 -1.78719,-1.72 -3.02344,-1.70656h-100.25719c-1.54531,-5.89906 -6.89344,-10.32 -13.26281,-10.32zM48.16,127.28c3.73563,0 6.67844,2.87563 6.83969,6.57094c-0.01344,0.20156 -0.01344,0.41656 0,0.63156c-0.16125,3.68188 -3.10406,6.5575 -6.83969,6.5575c-3.73562,0 -6.67844,-2.87562 -6.83969,-6.57094c0.01344,-0.20156 0.01344,-0.41656 0,-0.63156c0.16125,-3.68187 3.10406,-6.5575 6.83969,-6.5575z">
          </path>
        </g>
      </g>
    </svg>
    <!-- </span> -->
    <p>filter</p>
  </div>

</div>


<div class="">
  <!-- display each listing as a card  -->
  {% if items %}
  {% for item in items%}
  {% with e=item.expiry_date %}
  {% if e > now %}
  <a href="{% url 'listings_detail' item.id %}">
    <div class="card">

      <!-- AWS photo uploads -->
      {% if item.photo_set.all %}
      <div class="card-image">
        <img class="listing-image" src="{{ item.photo_set.first.url }}">
      </div>
      {% else %}
      <div class="card-image">
        <img class="listing-image" src="{% static 'images/no-image.png' %}">
      </div>
      {% endif %}

      <div class="card-text">
        <h5 class="card-title">{{ item.name }}</h5>
        <p>${{ item.current_highest_bid }}</p>
        <p>{{ item.number_of_bids }} bids &#8226 {{ item.time_remaining }}</p>
      </div>
    </div>
  </a>

  {% endif %}
  {% endwith %}
  {% endfor %}
  {% else %}
  <h4> No results matched your search</h4>
  {% endif %}
</div>



<script>
  // save checked option upon refresh- sortby
  let chosenSortBy = document.querySelector(".sort-options")
  let chosenSortById = chosenSortBy.id.substring(3);
  let target1 = document.getElementById(`${chosenSortById}`);
  if (target1 !== null) {
    target1.checked = true;
  }


  // save checked option upon refresh - filter
  let chosenCategory = document.querySelector(".category-options")
  let chosenCategoryId = chosenCategory.id.substring(3);
  let target2 = document.getElementById(`${chosenCategoryId}`);
  if (target2 !== null) {
    target2.checked = true;
  }

  // popup for sort options
  let sortPopup = document.getElementById("sort-popup")
  let sortIcon = document.getElementById("sort-icon")
  sortIcon.addEventListener("click", function (e) {
    sortPopup.classList.toggle("visible")
  })

  // popup for filter options
  let filterPopup = document.getElementById("filter-popup")
  let filterIcon = document.getElementById("filter-icon")
  filterIcon.addEventListener("click", function (e) {
    filterPopup.classList.toggle("visible")
  })

  //Change filter icon to show if filters applied
  let categoryOptions = document.querySelectorAll(".category-options input")
  for (let option of categoryOptions) {
    if (option.checked == true) {
      filterIcon.innerHTML = `    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30" height="30" viewBox="0 0 172 172"
      style=" fill:#000000;">
      <g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter"
        stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none"
        font-size="none" text-anchor="none" style="mix-blend-mode: normal">
        <path d="M0,172v-172h172v172z" fill="none" stroke="none"></path>
        <g id="original-icon" fill="#000000" stroke="none" opacity="0" visibility="hidden">
          <path
            d="M86,24.08c-6.36937,0 -11.7175,4.42094 -13.26281,10.32h-62.41719c-1.23625,-0.01344 -2.39187,0.63156 -3.02344,1.70656c-0.61813,1.075 -0.61813,2.39187 0,3.46687c0.63156,1.075 1.78719,1.72 3.02344,1.70656h62.41719c1.54531,5.89906 6.89344,10.32 13.26281,10.32c6.36938,0 11.7175,-4.42094 13.26281,-10.32h62.41719c1.23625,0.01344 2.39188,-0.63156 3.02344,-1.70656c0.61813,-1.075 0.61813,-2.39187 0,-3.46687c-0.63156,-1.075 -1.78719,-1.72 -3.02344,-1.70656h-62.41719c-1.54531,-5.89906 -6.89344,-10.32 -13.26281,-10.32zM86,30.96c3.73563,0 6.67844,2.87563 6.83969,6.57094c-0.01344,0.20156 -0.01344,0.41656 0,0.63156c-0.16125,3.68188 -3.10406,6.5575 -6.83969,6.5575c-3.73562,0 -6.67844,-2.87562 -6.83969,-6.57094c0.01344,-0.20156 0.01344,-0.41656 0,-0.63156c0.16125,-3.68187 3.10406,-6.5575 6.83969,-6.5575zM134.16,72.24c-6.36937,0 -11.7175,4.42094 -13.26281,10.32h-110.57719c-1.23625,-0.01344 -2.39187,0.63156 -3.02344,1.70656c-0.61813,1.075 -0.61813,2.39187 0,3.46687c0.63156,1.075 1.78719,1.72 3.02344,1.70656h110.57719c1.54531,5.89906 6.89344,10.32 13.26281,10.32c6.36938,0 11.7175,-4.42094 13.26281,-10.32h14.25719c1.23625,0.01344 2.39188,-0.63156 3.02344,-1.70656c0.61813,-1.075 0.61813,-2.39187 0,-3.46687c-0.63156,-1.075 -1.78719,-1.72 -3.02344,-1.70656h-14.25719c-1.54531,-5.89906 -6.89344,-10.32 -13.26281,-10.32zM134.16,79.12c3.73563,0 6.67844,2.87563 6.83969,6.57094c-0.01344,0.20156 -0.01344,0.41656 0,0.63156c-0.16125,3.68188 -3.10406,6.5575 -6.83969,6.5575c-3.73562,0 -6.67844,-2.87562 -6.83969,-6.57094c0.01344,-0.20156 0.01344,-0.41656 0,-0.63156c0.16125,-3.68187 3.10406,-6.5575 6.83969,-6.5575zM48.16,120.4c-6.36937,0 -11.7175,4.42094 -13.26281,10.32h-24.57719c-1.23625,-0.01344 -2.39187,0.63156 -3.02344,1.70656c-0.61813,1.075 -0.61813,2.39187 0,3.46687c0.63156,1.075 1.78719,1.72 3.02344,1.70656h24.57719c1.54531,5.89906 6.89344,10.32 13.26281,10.32c6.36938,0 11.7175,-4.42094 13.26281,-10.32h100.25719c1.23625,0.01344 2.39188,-0.63156 3.02344,-1.70656c0.61813,-1.075 0.61813,-2.39187 0,-3.46687c-0.63156,-1.075 -1.78719,-1.72 -3.02344,-1.70656h-100.25719c-1.54531,-5.89906 -6.89344,-10.32 -13.26281,-10.32zM48.16,127.28c3.73563,0 6.67844,2.87563 6.83969,6.57094c-0.01344,0.20156 -0.01344,0.41656 0,0.63156c-0.16125,3.68188 -3.10406,6.5575 -6.83969,6.5575c-3.73562,0 -6.67844,-2.87562 -6.83969,-6.57094c0.01344,-0.20156 0.01344,-0.41656 0,-0.63156c0.16125,-3.68187 3.10406,-6.5575 6.83969,-6.5575z">
          </path>
        </g>
        <g id="subtracted-icon" fill="#000000" stroke="none">
          <path
            d="M99.26281,34.4h62.41719c1.23625,-0.01344 2.39188,0.63156 3.02344,1.70656c0.61813,1.075 0.61813,2.39187 0,3.46687c-0.63156,1.075 -1.78719,1.72 -3.02344,1.70656h-62.41719c-1.54531,5.89906 -6.89344,10.32 -13.26281,10.32c-6.36937,0 -11.7175,-4.42094 -13.26281,-10.32h-62.41719c-1.23625,0.01344 -2.39187,-0.63156 -3.02344,-1.70656c-0.61813,-1.075 -0.61813,-2.39187 0,-3.46687c0.63156,-1.075 1.78719,-1.72 3.02344,-1.70656h62.41719c1.54531,-5.89906 6.89344,-10.32 13.26281,-10.32c6.36938,0 11.7175,4.42094 13.26281,10.32zM79.16031,37.5175c0.01344,0.215 0.01344,0.43 0,0.63156c0.16125,3.69531 3.10406,6.57094 6.83969,6.57094c3.73563,0 6.67844,-2.87562 6.83969,-6.5575c-0.01344,-0.215 -0.01344,-0.43 0,-0.63156c-0.16125,-3.69531 -3.10406,-6.57094 -6.83969,-6.57094c-3.73562,0 -6.67844,2.87563 -6.83969,6.5575zM147.42281,82.56h14.25719c1.23625,-0.01344 2.39188,0.63156 3.02344,1.70656c0.61813,1.075 0.61813,2.39187 0,3.46687c-0.63156,1.075 -1.78719,1.72 -3.02344,1.70656h-14.25719c-0.75007,2.86331 -2.39607,5.37837 -4.61991,7.20867c-1.70496,-0.21686 -3.44151,-0.32867 -5.2029,-0.32867c-3.66285,0 -7.21826,0.48349 -10.60556,1.3898c-2.96895,-1.84859 -5.18938,-4.8041 -6.09725,-8.2698h-110.57719c-1.23625,0.01344 -2.39187,-0.63156 -3.02344,-1.70656c-0.61813,-1.075 -0.61813,-2.39187 0,-3.46687c0.63156,-1.075 1.78719,-1.72 3.02344,-1.70656h110.57719c1.54531,-5.89906 6.89344,-10.32 13.26281,-10.32c6.36938,0 11.7175,4.42094 13.26281,10.32zM127.32031,85.6775c0.01344,0.215 0.01344,0.43 0,0.63156c0.16125,3.69531 3.10406,6.57094 6.83969,6.57094c3.73563,0 6.67844,-2.87562 6.83969,-6.5575c-0.01344,-0.215 -0.01344,-0.43 0,-0.63156c-0.16125,-3.69531 -3.10406,-6.57094 -6.83969,-6.57094c-3.73562,0 -6.67844,2.87563 -6.83969,6.5575zM61.42281,130.72h35.47459c-0.37964,2.23881 -0.5774,4.53743 -0.5774,6.88h-34.89719c-1.54531,5.89906 -6.89344,10.32 -13.26281,10.32c-6.36937,0 -11.7175,-4.42094 -13.26281,-10.32h-24.57719c-1.23625,0.01344 -2.39187,-0.63156 -3.02344,-1.70656c-0.61813,-1.075 -0.61813,-2.39187 0,-3.46687c0.63156,-1.075 1.78719,-1.72 3.02344,-1.70656h24.57719c1.54531,-5.89906 6.89344,-10.32 13.26281,-10.32c6.36938,0 11.7175,4.42094 13.26281,10.32zM41.32031,133.8375c0.01344,0.215 0.01344,0.43 0,0.63156c0.16125,3.69531 3.10406,6.57094 6.83969,6.57094c3.73563,0 6.67844,-2.87562 6.83969,-6.5575c-0.01344,-0.215 -0.01344,-0.43 0,-0.63156c-0.16125,-3.69531 -3.10406,-6.57094 -6.83969,-6.57094c-3.73562,0 -6.67844,2.87563 -6.83969,6.5575z">
          </path>
        </g>
        <g stroke="none">
          <g id="Layer_9" fill="#f2c34f">
            <path
              d="M137.6,103.2c-18.92,0 -34.4,15.48 -34.4,34.4c0,18.92 15.48,34.4 34.4,34.4c18.92,0 34.4,-15.48 34.4,-34.4c0,-18.92 -15.48,-34.4 -34.4,-34.4zM141.04,151.36h-6.88v-20.296l-6.88,1.72v-4.816l13.072,-4.128h0.688z">
            </path>
          </g>
          <g fill="#000000" opacity="0">
            <g id="IOS" font-family="Inter, sans-serif" font-weight="400" font-size="16" text-anchor="start"
              visibility="hidden"></g>
            <g id="IOS_copy">
              <path
                d="M137.6,178.88c22.704,0 41.28,-18.576 41.28,-41.28c0,-22.704 -18.576,-41.28 -41.28,-41.28c-22.704,0 -41.28,18.576 -41.28,41.28c0,22.704 18.576,41.28 41.28,41.28z">
              </path>
            </g>
          </g>
        </g>
        <path d="M103.2,172v-68.8h68.8v68.8z" id="overlay-drag" fill="#ff0000" stroke="none" opacity="0"></path>
      </g>
    </svg> 
    <p>filter</p>`
    }
  }

  //Change filter icon to show if filters applied
  let sortOptions = document.querySelectorAll(".sort-options input")
  for (let option of sortOptions) {
    if (option.checked == true) {
      sortIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
      width="30" height="30"
viewBox="0 0 172 172"
style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none" stroke="none"></path><g id="original-icon" fill="#000000" stroke="none" opacity="0" visibility="hidden"><path d="M86,12.33563l-63.34437,63.34437h126.68875zM86,22.06438l46.73563,46.73562h-93.47125zM22.65563,89.44l63.34437,63.34438l63.34438,-63.34438zM39.26438,96.32h93.47125l-46.73563,46.73563z"></path></g><g id="subtracted-icon" fill="#000000" stroke="none"><path d="M149.34438,75.68h-126.68875l63.34437,-63.34437zM39.26438,68.8h93.47125l-46.73563,-46.73562zM149.34438,89.44l-7.13731,7.13731c-1.51318,-0.16999 -3.05042,-0.25731 -4.60707,-0.25731c-1.75751,0 -3.49027,0.11131 -5.19161,0.32723l0.32723,-0.32723h-93.47125l46.73562,46.73563l10.64723,-10.64723c-0.21592,1.70133 -0.32723,3.4341 -0.32723,5.19161c0,1.55665 0.08732,3.09389 0.25731,4.60707l-10.57731,10.57731l-63.34437,-63.34438z"></path></g><g stroke="none"><g id="Layer_9" fill="#f2c34f"><path d="M137.6,103.2c-18.92,0 -34.4,15.48 -34.4,34.4c0,18.92 15.48,34.4 34.4,34.4c18.92,0 34.4,-15.48 34.4,-34.4c0,-18.92 -15.48,-34.4 -34.4,-34.4zM141.04,151.36h-6.88v-20.296l-6.88,1.72v-4.816l13.072,-4.128h0.688z"></path></g><g fill="#000000" opacity="0"><g id="IOS" font-family="Inter, sans-serif" font-weight="400" font-size="16" text-anchor="start" visibility="hidden"></g><g id="IOS_copy"><path d="M137.6,178.88c22.704,0 41.28,-18.576 41.28,-41.28c0,-22.704 -18.576,-41.28 -41.28,-41.28c-22.704,0 -41.28,18.576 -41.28,41.28c0,22.704 18.576,41.28 41.28,41.28z"></path></g></g></g><path d="M103.2,172v-68.8h68.8v68.8z" id="overlay-drag" fill="#ff0000" stroke="none" opacity="0"></path></g></svg>
        <p>sort</p>`
    }
  }

</script>




{% endblock %}